{
   "title": "YAP Spring Cleaning",
   "sidebar": [
      {
         "name": "step_1",
         "label": "Onboard Devices"
      },
      {
         "name": "step_2",
         "label": "Service Provision - TBA"
      }
   ],
   "preface": [
      {
         "title": "Device Onboarding",
         "stepDesc": "Onboarding",
         "bodyArr": ["Assessing feasability of YAP as baseline for automation demos: demonstating device onboard on NSO"]
      },
      {
         "title": "TBA Title 2",
         "stepDesc": "TBA Step 2",
         "bodyArr": ["TO be created"]
      }
   ],
   "endpoints": {
      "NSO": {
         "baseURL": "http://10.76.230.28:8888/nso",
         "headers": {
            "Content-Type": "application/yang-data+json",
            "Accept": "application/yang-data+json",
            "Authorization": "Basic YWRtaW46YWRtaW4="
         }
      }
   },
   "mainContent": {
      "step_1": {
         "description": ["Onboard device on NSO instance"],
         "continueOnFail": false,
         "actions": [
            {
               "type": "request",
               "useEndpoint": "NSO",
               "header": "Create",
               "headerColor": "Green",
               "title": "Create devices in NSO",
               "description": "Add Node_8 and Node_9 to NSO configuration",
               "url": "restconf/data/tailf-ncs:devices",
               "method": "post",
               "data": {
                  "device": [
                     {
                        "name": "Node_8",
                        "address": "10.76.230.237",
                        "port": 22,
                        "authgroup": "router",
                        "device-type": {
                           "cli": {
                              "ned-id": "cisco-iosxr-cli-7.49:cisco-iosxr-cli-7.49"
                           }
                        },
                        "ssh-algorithms": {
                           "public-key": ["ssh-rsa"]
                        },
                        "state": {
                           "admin-state": "unlocked"
                        }
                     },
                     {
                        "name": "Node_9",
                        "address": "10.76.230.237",
                        "port": 22,
                        "authgroup": "router",
                        "device-type": {
                           "cli": {
                              "ned-id": "cisco-iosxr-cli-7.49:cisco-iosxr-cli-7.49"
                           }
                        },
                        "ssh-algorithms": {
                           "public-key": ["ssh-rsa"]
                        },
                        "state": {
                           "admin-state": "unlocked"
                        }
                     }
                  ]
               },
               "expect": [
                  {
                     "type": "codeIs",
                     "value": "201"
                  }
               ]
            },
            {
               "type": "request",
               "useEndpoint": "NSO",
               "header": "SSH Keys",
               "headerColor": "",
               "title": "Fetch SSH keys - having some issues :-(, with the connection but still return 200",
               "description": "Fetch SSH keys form the newly created routers",
               "url": "restconf/data/tailf-ncs:devices/fetch-ssh-host-keys",
               "method": "post",
               "data": {},
               "expect": [
                  {
                     "type": "codeIs",
                     "value": "200"
                  },
                  {
                     "type": "bodyContain",
                     "value": "fingerprint"
                  }
               ]
            },
            {
               "type": "request",
               "useEndpoint": "NSO",
               "header": "Sync",
               "headerColor": "",
               "title": "Syncronize configuration from the router - fails if I can not fetch the ssh keys :-( but still return 200, need to check in data",
               "description": "If sync-from fail, one or mode nodes will have 'Failed to authenticate towards device Node_8: SSH host key mismatch'",
               "url": "restconf/data/tailf-ncs:devices/sync-from",
               "method": "post",
               "data": {},
               "expect": [
                  {
                     "type": "codeIs",
                     "value": ["200"]
                  },
                  {
                     "type": "bodyContain",
                     "value": "true"
                  }
               ]
            }
         ],
         "validations": [],
         "outcome": {
            "summaryText": "Routers have been created",
            "elements": {
               "nodes": [
                  {
                     "data": { "id": "melbourne" },
                     "position": { "x": 0, "y": 150 },
                     "classes": ["router"]
                  },
                  {
                     "data": { "id": "sydney" },
                     "position": { "x": 200, "y": 150 },
                     "classes": ["highlight", "router"]
                  }
               ],
               "edges": []
            },
            "commands": {
               "sydney": [
                  {
                     "type": "request",
                     "useEndpoint": "mockAPI",
                     "displayResponseAs": "json",
                     "title": "Get router details",
                     "url": "/api/devices/1",
                     "method": "get"
                  }
               ]
            }
         }
      },
      "step_2": {
         "description": ["TBA"],
         "continueOnFail": false,
         "actions": [
            {
               "type": "request",
               "useEndpoint": "NSO",
               "header": "Create",
               "headerColor": "Green",
               "title": "Configure Authentication",
               "description": "Add authentication group required to access network routers",
               "url": "restconf/data/tailf-ncs:devices/authgroups/group=test",
               "method": "post",
               "data": "",
               "expect": [
                  {
                     "type": "codeIs",
                     "value": "200"
                  }
               ]
            }
         ],
         "validations": [],
         "outcome": {
            "summaryText": "Melbourne to Sydney link has been created"
         }
      },
      "cleanup": {
         "description": [
            "The follwoing procedure is required to clean and assure there is no corrupted service (i.e. Zombies services) left behind"
         ],
         "continueOnFail": false,
         "actions": [
            {
               "type": "request",
               "useEndpoint": "NSO",
               "header": "Delete",
               "headerColor": "red",
               "title": "Remove Node_8 from NSO",
               "description": "",
               "url": "restconf/data/tailf-ncs:devices/device=Node_8",
               "method": "delete",
               "expect": [
                  {
                     "type": "codeIs",
                     "value": ["204", "404"]
                  }
               ]
            },
            {
               "type": "request",
               "useEndpoint": "NSO",
               "header": "Delete",
               "headerColor": "red",
               "title": "Remove Node_9 from NSO",
               "description": "",
               "url": "restconf/data/tailf-ncs:devices/device=Node_9",
               "method": "delete",
               "expect": [
                  {
                     "type": "codeIs",
                     "value": ["204", "404"]
                  }
               ]
            }
         ],
         "validations": []
      }
   }
}
